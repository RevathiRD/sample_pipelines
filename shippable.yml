# Language setting
language: python

# Version number
python:
  - 2.7

env:
  global:
  #Testing for user defined envs and secure envs
    - TEST=FOO
    - IMAGE_NAME=742038439709.dkr.ecr.us-west-2.amazonaws.com/sample_node
    - IMAGE_TAG=latest.40
    - IMAGE_PULL=true   
    
build:
  pre_ci:
  #Testing for pre_ci carrying over to pre_ci_boot
    - export IMAGE_TAG="latest"
    - echo $IMAGE_TAG
    - docker build -t=$IMAGE_NAME .
    
  pre_ci_boot:
    image_name: $IMAGE_NAME
    image_tag: $IMAGE_TAG
    pull: $IMAGE_PULL
    options: '--privileged=true --net=bridge -e FOO=true -e BOO=false'

  ci:
    - python --version
    - docker pull $IMAGE_NAME:$IMAGE_TAG
  
  post_ci:
    - docker push $IMAGE_NAME:$IMAGE_TAG

integrations:
  hub: 
  #ecr with new integration using "hub" tag in integrations
    - integrationName: awskeys
      region: us-west-2
      type: amazonKeys
  
  #deploy: 
  #elastic beanstalk with new awskeys integrations using "deploy" tag in integrations
    #- integrationName: awskeys
    #  type: amazonKeys
    #  target: eb_paas
    #  platform: Node.js
    #  application_name: sample-app
    #  env_name: sample-appEnv
    #  region: us-east-1
      
  cli:
  #elastic beanstalk using "cli" tag in integrations
    - integrationName: awskeys
      type: amazonKeys
      scope: ebs #new
      platform: Node.js
      application_name: sample-app
      env_name: SampleApp-env
      region: us-west-2
  
    - integrationName: awskeys
      type: amazonKeys
      scope: ecr #new
      region: us-east-1      
    #  branches: #Testing the wildcards for branches exclude
      #  except:
     #   - n*

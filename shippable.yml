# Language setting
language: node_js

# Version number
node_js:
  - 6.11

env:
  global:
    - AWS_S3_BUCKET='s3://push-to-s3'
    - AWS_S3_REGION='us-east-1'
    - secure: i1asR78CGO6V/DCJOAY2XHPecFXhj/F0qlWUUPwlpBZSDYo6HVcBEDFCFw0SCklLs5hwfttxWE+opU5TLeH//Hl1OUwgKsivgi9x7gxGcupmHRZN4asjW9Cw0gsOXgke/x0CcU+7HRtx1vSDHxi6aZAjf9WIFOZv0qDqn9PDBn3Iw9bSqbtcG2Lxrg3Ib6aiP4bw6ccb7jIHgywJdUMiT+Bo7i+yrt6e94Z92YAawRBSqDSOZz3NtDXI4sz+JzICXBhf4q/Q4LzpVtZ8wc5DVrJL1Ashhl7FunC3KBeSW6hvz2FfZsCpNDDg7652Vsb4QvF2jD8APnOQw4mV5EY+Ug==
    
build:
  pre_ci:
  #Testing for pre_ci carrying over to pre_ci_boot
    - docker build -t=742038439709.dkr.ecr.us-west-2.amazonaws.com/sample_node .

  ci:
    - python --version
    - docker pull 742038439709.dkr.ecr.us-west-2.amazonaws.com/sample_node
  
  post_ci:
    - docker push 742038439709.dkr.ecr.us-west-2.amazonaws.com/sample_node
    - aws s3 sync $SHIPPABLE_BUILD_DIR "$AWS_S3_BUCKET" --region "$AWS_S3_REGION"

integrations:
  hub: 
  #ecr with new integration using "hub" tag in integrations
    - integrationName: awskeys
      type: amazonKeys
      region: us-west-2  
      
  deploy: 
  #elastic beanstalk with new awskeys integrations using "deploy" tag in integrations
    - integrationName: awskeys
      type: amazonKeys
      target: eb_paas
      platform: Node.js
      application_name: sample-app
      env_name: SampleApp-env-1
      region: us-east-1
    
    - integrationName: awskeys
      type: amazonKeys
      target: eb_docker
      application_name: "sample-docker"
      env_name: SampleDocker-env-2
      bucket_name: "push-to-s3"
      region: "us-east-1"
      image_name: "shippabledocker/sample_node"
      image_tag: "$BRANCH.$BUILD_NUMBER"
